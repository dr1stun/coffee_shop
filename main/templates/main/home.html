{% extends 'base.html' %}
{% load static %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ö–æ—Ñ–µ–π–Ω—è{% endblock %}

{% block content %}
<h1 class="mb-4">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É –∫–æ—Ñ–µ–π–Ω—é!</h1>

<!-- –í–°–Å –ú–ï–ù–Æ –í–û –í–°–Æ –®–ò–†–ò–ù–£ -->
<div class="row">
    <div class="col-12">  <!-- –ò–ó–ú–ï–ù–ò–õ: col-12 –≤–º–µ—Å—Ç–æ col-md-6 col-lg-4 -->
        <div class="card widget-card">
            <div class="card-header">
                <h5 class="card-title mb-0">üçΩÔ∏è –ü–æ–ª–Ω–æ–µ –º–µ–Ω—é</h5>
            </div>
            <div class="card-body">
                {% if categories %}
                    <div class="menu-scrollable" style="max-height: 600px; overflow-y: auto;">  <!-- –£–í–ï–õ–ò–ß–ò–õ –≤—ã—Å–æ—Ç—É -->
                    {% for category in categories %}
                        <div class="category-section mb-4">  <!-- –£–í–ï–õ–ò–ß–ò–õ –æ—Ç—Å—Ç—É–ø -->
                            <h6 class="category-title" style="color: #1e90ff; border-bottom: 1px solid #1e90ff; padding-bottom: 5px;">
                                {{ category.name }}
                                <small class="badge bg-primary">{{ category.products.count }}</small>
                            </h6>

                            {% with category_products=category.products.all %}
                                {% if category_products %}
                                    <div class="row">  <!-- –î–û–ë–ê–í–ò–õ: —Å–µ—Ç–∫—É –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ -->
                                    {% for product in category_products %}
                                        <div class="col-md-6 col-lg-4 mb-3">  <!-- –î–û–ë–ê–í–ò–õ: –∫–æ–ª–æ–Ω–∫–∏ -->
                                            <div class="product-item-small p-3" style="border-radius: 8px; background-color: #2a2a2a; cursor: pointer; height: 100%;"
                                                 onclick="window.location.href='{% url 'product_detail' product.id %}'">
                                                <div class="d-flex justify-content-between align-items-start mb-2">
                                                    <div class="flex-grow-1">
                                                        <strong class="d-block">{{ product.name }}</strong>
                                                        {% if product.description %}
                                                            <small class="text-muted d-block">{{ product.description|truncatewords:10 }}</small>
                                                        {% endif %}
                                                    </div>
                                                    <div class="text-end ms-2">
                                                        <span class="price fw-bold">{{ product.price }} ‚Ç¨</span>
                                                        {% if product.is_available %}
                                                            <span class="badge bg-success d-block mt-1">‚úì</span>
                                                        {% else %}
                                                            <span class="badge bg-danger d-block mt-1">‚úó</span>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                {% if product.image %}
                                                    <div class="text-center mt-2">
                                                        <img src="{{ product.image.url }}" alt="{{ product.name }}"
                                                             class="img-fluid rounded" style="max-height: 80px; width: auto;">
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                    </div>
                                {% else %}
                                    <p class="text-muted">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
                                {% endif %}
                            {% endwith %}
                        </div>
                        {% if not forloop.last %}<hr style="border-color: #444; margin: 25px 0;">{% endif %}
                    {% endfor %}
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–µ–Ω—é -->
                    <div class="menu-stats mt-4 p-3" style="background-color: #2a2a2a; border-radius: 8px;">
                        <div class="row text-center">
                            <div class="col-md-3 col-6">
                                <h4 class="mb-0" style="color: #1e90ff;">{{ categories_count }}</h4>
                                <small>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</small>
                            </div>
                            <div class="col-md-3 col-6">
                                <h4 class="mb-0" style="color: #1e90ff;">{{ all_products_count }}</h4>
                                <small>–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π</small>
                            </div>
                            <div class="col-md-3 col-6">
                                <h4 class="mb-0" style="color: #1e90ff;">{{ available_products_count }}</h4>
                                <small>–î–æ—Å—Ç—É–ø–Ω–æ</small>
                            </div>
                            <div class="col-md-3 col-6">
                                <h4 class="mb-0" style="color: #1e90ff;">{{ categories.count }}</h4>
                                <small>–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</small>
                            </div>
                        </div>
                    </div>

                {% else %}
                    <p class="text-center">–ú–µ–Ω—é –ø–æ–∫–∞ –ø—É—Å—Ç–æ–µ.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –û–°–¢–ê–õ–¨–ù–´–ï –í–ò–î–ñ–ï–¢–´ –ü–û–î –ú–ï–ù–Æ -->
<div class="row mt-4">
    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã -->
    <div class="col-md-4">
        <div class="card widget-card mb-3">
            <div class="card-header">
                <h5 class="card-title mb-0">‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h5>
            </div>
            <div class="card-body">
                {% if popular_products %}
                    {% for product in popular_products|slice:":5" %}
                    <div class="product-item-small mb-2 p-2" style="border-radius: 5px; background-color: #2a2a2a; cursor: pointer;"
                         onclick="window.location.href='{% url 'product_detail' product.id %}'">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="flex-grow-1">
                                <strong class="d-block">{{ product.name }}</strong>
                                <span class="price">{{ product.price }} ‚Ç¨</span>
                            </div>
                            {% if product.is_available %}
                                <span class="badge bg-success">‚úì</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>–ü–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ù–æ–≤–∏–Ω–∫–∏ -->
    <div class="col-md-4">
        <div class="card widget-card mb-3">
            <div class="card-header">
                <h5 class="card-title mb-0">üÜï –ù–æ–≤–∏–Ω–∫–∏</h5>
            </div>
            <div class="card-body">
                {% if new_products %}
                    {% for product in new_products|slice:":5" %}
                    <div class="product-item-small mb-2 p-2" style="border-radius: 5px; background-color: #2a2a2a; cursor: pointer;"
                         onclick="window.location.href='{% url 'product_detail' product.id %}'">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="flex-grow-1">
                                <strong class="d-block">{{ product.name }}</strong>
                                <span class="price">{{ product.price }} ‚Ç¨</span>
                            </div>
                            {% if product.is_available %}
                                <span class="badge bg-success">‚úì</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>–ù–æ–≤—ã—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                {% endif %}
            </div>
        </div>
    </div>

</div>

<div id="how-it-works" class="content mb-5">
    <div class="card widget-card">
        <div class="card-body">
            <h2 class="h2-blue-left text-center mb-4" style="color: #1e90ff; font-size: 2rem;">
                –î–µ–ª–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã —É–¥–æ–±–Ω–µ–µ –∏ —É—é—Ç–Ω–µ–µ<br>
                –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ–º –Ω–∞ –Ω–æ–≤—ã–π –∫–æ—Ñ–µ–π–Ω—ã–π –æ–ø—ã—Ç
            </h2>

            <div class="row">
                <div class="col-lg-6">
                    <h4 class="how-it-works-header mb-4" style="color: #1e90ff; border-bottom: 2px solid #1e90ff; padding-bottom: 10px;">
                        –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—è
                    </h4>

                    <div class="tech-items">
                        <!-- –ü—É–Ω–∫—Ç 1 -->
                        <div class="tech-item mb-3 p-3" style="background-color: #2a2a2a; border-radius: 8px; border-left: 4px solid #1e90ff;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: #ffffff;"><strong>–ó–∞–∫–∞–∑—ã–≤–∞–π –ø–æ –ø—É—Ç–∏</strong></h5>
                                <img src="https://cdn.prod.website-files.com/65d79202b393b8bd1cf1e4db/6659cfce844fe2426bfaf97c_arrow.svg"
                                     loading="lazy" alt="" style="width: 20px; height: 20px; filter: invert(1);">
                            </div>
                            <div class="how-it-works-text mt-2" style="color: #e0e0e0;">
                                –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∏—Ç —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–æ–≤—ã–π –±–µ—Å—à–æ–≤–Ω—ã–π –æ–ø—ã—Ç –ø—Ä–∏–≤—ã—á–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ –∫–æ—Ñ–µ!
                                –¢—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ –ø–æ –ø—É—Ç–∏ –≤ –æ—Ñ–∏—Å, –Ω–∞ —É—á—ë–±—É, –≤ –≥–æ—Å—Ç–∏ –∏–ª–∏ –Ω–∞ –ø—Ä–æ–≥—É–ª–∫—É –≤ –ø–∞—Ä—É –∫–ª–∏–∫–æ–≤
                            </div>
                        </div>

                        <!-- –ü—É–Ω–∫—Ç 2 -->
                        <div class="tech-item mb-3 p-3" style="background-color: #2a2a2a; border-radius: 8px; border-left: 4px solid #1e90ff;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: #ffffff;">–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–π –∫–∞–∫ —Ç—ã –ª—é–±–∏—à—å</h5>
                                <img src="https://cdn.prod.website-files.com/65d79202b393b8bd1cf1e4db/6659cfce844fe2426bfaf97c_arrow.svg"
                                     loading="lazy" alt="" style="width: 20px; height: 20px; filter: invert(1);">
                            </div>
                            <div class="how-it-works-text mt-2" style="color: #e0e0e0;">
                                –ß–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—ã –º–æ–∂–µ—à—å –ø–æ–º–µ–Ω—è—Ç—å –º–æ–ª–æ–∫–æ –Ω–∞ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ, –≤—ã–±—Ä–∞—Ç—å —Å–∏—Ä–æ–ø –∏–ª–∏ –ø–æ—Å—ã–ø–∫—É –Ω–∞ —Å–≤–æ–π –≤–∫—É—Å,
                                –∞ –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞—à—É —Ñ–∏—Ä–º–µ–Ω–Ω—É—é —Å–ª–∏–≤–æ—á–Ω—É—é –ø–µ–Ω–∫—É, —Ç–æ –ª—é–±–æ–π –Ω–∞–ø–∏—Ç–æ–∫ —Å—Ä–∞–∑—É —Å—Ç–∞–Ω–µ—Ç –¥–µ—Å–µ—Ä—Ç–Ω—ã–º
                            </div>
                        </div>

                        <!-- –ü—É–Ω–∫—Ç 3 -->
                        <div class="tech-item mb-3 p-3" style="background-color: #2a2a2a; border-radius: 8px; border-left: 4px solid #1e90ff;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: #ffffff;">–°–ª–µ–¥–∏ –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º –∑–∞–∫–∞–∑–∞</h5>
                                <img src="https://cdn.prod.website-files.com/65d79202b393b8bd1cf1e4db/6659cfce844fe2426bfaf97c_arrow.svg"
                                     loading="lazy" alt="" style="width: 20px; height: 20px; filter: invert(1);">
                            </div>
                            <div class="how-it-works-text mt-2" style="color: #e0e0e0;">
                                –ó–∞–Ω–∏–º–∞–π—Å—è —Å–≤–æ–∏–º–∏ –¥–µ–ª–∞–º–∏, –∞ –º—ã –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏–º, –∫–æ–≥–¥–∞ —Ç–≤–æ–π –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤
                            </div>
                        </div>

                        <!-- –ü—É–Ω–∫—Ç 4 -->
                        <div class="tech-item mb-3 p-3" style="background-color: #2a2a2a; border-radius: 8px; border-left: 4px solid #1e90ff;">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" style="color: #ffffff;">–ó–∞–±–∏—Ä–∞–π –∑–∞–∫–∞–∑ —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –±–∞—Ä–∞-–≤—ã–¥–∞—á–∏</h5>
                                <img src="https://cdn.prod.website-files.com/65d79202b393b8bd1cf1e4db/6659cfce844fe2426bfaf97c_arrow.svg"
                                     loading="lazy" alt="" style="width: 20px; height: 20px; filter: invert(1);">
                            </div>
                            <div class="how-it-works-text mt-2" style="color: #e0e0e0;">
                                –ì–æ—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å —Ç–µ–±—è —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–∏–Ω—É—Ç –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π —è—á–µ–π–∫–µ —Å —Ç–≤–æ–∏–º –∏–º–µ–Ω–µ–º –∏ –Ω–æ–º–µ—Ä–æ–º –∑–∞–∫–∞–∑–∞
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –õ—É—á—à–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card widget-card">
            <div class="card-header">
                <h5 class="card-title mb-0">üëë –¢–æ–ø –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏</h5>
            </div>
            <div class="card-body">
                {% if top_customers %}
                    {% for customer in top_customers %}
                    <div class="customer-item mb-2 p-2" style="border-radius: 5px; background-color: #2a2a2a;">
                        <strong>{{ customer.first_name }} {{ customer.last_name }}</strong>
                        <br>
                        <small class="text-muted">{{ customer.order_count }} –∑–∞–∫–∞–∑–æ–≤</small>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>–ü–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card widget-card">
            <div class="card-header">
                <h5 class="card-title mb-0">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-3">
                        <div class="stats-item">
                            <h4 style="color: #1e90ff;">{{ all_products_count }}</h4>
                            <p>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</p>
                        </div>
                    </div>
                    <div class="col-6 mb-3">
                        <div class="stats-item">
                            <h4 style="color: #1e90ff;">{{ available_products_count }}</h4>
                            <p>–î–æ—Å—Ç—É–ø–Ω–æ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .menu-scrollable {
        scrollbar-width: thin;
        scrollbar-color: #1e90ff #2a2a2a;
    }

    .menu-scrollable::-webkit-scrollbar {
        width: 8px;
    }

    .menu-scrollable::-webkit-scrollbar-track {
        background: #2a2a2a;
        border-radius: 4px;
    }

    .menu-scrollable::-webkit-scrollbar-thumb {
        background: #1e90ff;
        border-radius: 4px;
    }

    .category-title {
        font-weight: bold;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.2rem;
    }

    .product-item-small {
        transition: all 0.3s ease;
        background-color: #2a2a2a;
        border: 1px solid #333;
    }

    .product-item-small:hover {
        background-color: #333 !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(30, 144, 255, 0.4);
        border-color: #1e90ff;
    }

    .price {
        color: #1e90ff;
        font-weight: bold;
        font-size: 1.1rem;
    }

    .stats-item {
        padding: 15px;
    }

    .stats-item h4 {
        font-size: 2rem;
        margin-bottom: 5px;
    }

    .badge {
        font-size: 0.7em;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å */
    [onclick] {
        cursor: pointer;
        transition: all 0.2s ease;
    }

    @media (max-width: 768px) {
        .menu-scrollable {
            max-height: 500px !important;
        }

        .product-item-small {
            margin-bottom: 15px !important;
        }

        .category-title {
            font-size: 1.1rem;
        }
    }
</style>

{% endblock %}